{% extends "base.html" %}

{% block title %}Processing Fails - Bill Review Portal{% endblock %}

{% block content %}
<div class="container">
    <h1>Failed Processing Documents
        {% if fails_count > 0 %}
        <span class="badge bg-danger ms-2">{{ fails_count }}</span>
        {% endif %}
    </h1>
    <p class="lead">Documents that failed validation during processing</p>
    <hr>

    <!-- Quick filter controls REMOVED -->

    <div class="list-group mt-4" id="bill-list-container">
        <!-- Populated by JavaScript -->
    </div>

    {% if fails_count == 0 %}
        <div class="alert alert-info">
            <i class="fas fa-check-circle me-2"></i>
            No failed processing files found.
            {% if request.args.get('filenames') %}
                (Based on provided filter)
            {% else %}
                 All documents have been processed successfully or moved.
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<!-- Include the view manager script (ensure renderBillList is defined here) -->
<script src="{{ url_for('static', filename='js/failed-bills-view-manager.js') }}"></script>

<!-- âœ… Prompt: In fails.html, just show whatever JSON is passed -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.BILLS_DATA = {{ bills_json | tojson | safe }};
    // Ensure renderBillList exists in failed-bills-view-manager.js
    if (window.renderBillList) {
        window.renderBillList(window.BILLS_DATA);
    } else {
        console.error('renderBillList function not found. Cannot display bills.');
        const container = document.getElementById('bill-list-container');
        if (container) {
            container.innerHTML = '<div class="alert alert-danger">Error: Could not load bill rendering script.</div>';
        }
    }
  });
</script>
{% endblock %}